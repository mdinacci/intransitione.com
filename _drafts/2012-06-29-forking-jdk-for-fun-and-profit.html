--- 
layout: post
title: Forking the OpenJDK for fun and profit.
tags: 
- Java
- OSX
- OpenJDK
- appbundler
---

<p>At my current job I'm tasked with bringing a Java Swing application to the App Store.</p>

<p>The way to do it, on OSX, is to bundle a Java distribution within the application as by Apple's terms it is no longer possible to distribute applications that rely on technologies optionally installed. As such, I started looking how to bundle the OpenJDK inside an OSX application.</p>

<p>It turns out <a href="java.net/projects/appbundler">AppBundler</a> does exactly that. So, task finished ? no, not quite...In the process of testing and improving our application I discovered several bugs in the OpenJDK and after six or seven patches applied we finally decided to maintain our own branch.</p> 

<p>My OpenJDK fork currently provides: </p>

<ul>
    <li>Support for <em>apple.awt.fileDialogForDirectories</em></li>
    <li>Support for opening applications using registered files. (Eg. clicking on a pdf file to open the registered application, say Adobe Reader)</li>
    <li>Fix a problem where the native save dialog doesn't save the extension of the file saved.</li>
    <li>Fix the <em>JMenuItem</em> not showing accelerators keys.</li>
    <li>Add universal binary (i386/x86_64) support.</li>
    <li>Shows the actual symbol keys for most of the symbols in the JMenuItem accelerators. Eg. shows <em>Ctrl+[</em> instead of <em>Ctrl+Open Bracket</em>.</li>
</ul>

<p>I hear you say, why forking instead of contributing back the changes ?</p>
<p>I did contribute one patch, but my other contributions weren't accepted for several reasons. <em>apple.awt.fileDialogForDirectories</em> is not going to be supported, so there's no interest in adding it. The univesal build change touches the whole OpenJDK not only the jdk repository, it's been contributed originally by somebody else and it is still currently been discussed. Regarding the <em>JMenuItem</em> fix, the real cause of the problem is still unknown, although my change still fixes the problem and correct an existing error. In general, it is a bit difficult to match our need to move quickly with the slow process of contributing an official patch to OpenJDK.</p>
<p>Finally, it's only the JDK repository that has been forked whereas the OpenJDK is made of several ones (hotspot, corba, langtools, jaxwp, jaxws, jdk).

<p>In addition to the OpenJDK fork, I also forked <em>AppBundler</em>, reason being, my perceived lack of interest and the slowness in adding new features (although I did propose patches that have been accepted).</p>

<p>My AppBundler fork features:</p>
    <li>The native binary is created as universal (32/64)</li>
    <li>Fixes icon not showing, linked to bug <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7159381">bug #7159381</a> in the OpenJDK.</li>
    <li>Add <em>classpathref</em> support to the <em>bundleapp</em> task.</li>
    <li>Add support for <em>LSArchitecturePriority</em> key.</li>
    <li>Allow to specify a custom value for <em>CFBundleVersion</em></li>
    <li>Allow specifying registered file extensions using <em>CFBundleDocumentTypes</em></li>
</ul>

<p>If you're a Java developer trying to bring your app to the Mac App Store, go ahead and download <a href="https://bitbucket.org/marcodinacci/openjdk7u-jdk">the jdk fork</a> and the <a href="https://bitbucket.org/marcodinacci/appbundler">AppBundler fork</a></p>.

<p>Marco</p>
